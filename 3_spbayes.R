RhpcBLASctl::blas_set_num_threads(4)

suppressMessages( library(spBayes) )

site_data = structure(
  list(
    site = c("010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010", "010030010", "010030010", "010030010", 
             "010030010", "010030010"), 
    day = c(2L, 5L, 8L, 11L, 14L, 17L, 
            20L, 23L, 26L, 29L, 32L, 35L, 38L, 41L, 44L, 47L, 50L, 53L, 56L, 
            59L, 62L, 65L, 68L, 71L, 74L, 77L, 80L, 83L, 86L, 89L, 92L, 95L, 
            98L, 101L, 104L, 107L, 110L, 113L, 116L, 119L, 122L, 125L, 128L, 
            131L, 134L, 137L, 143L, 146L, 149L, 152L, 155L, 158L, 161L, 164L, 
            167L, 170L, 173L, 176L, 179L, 182L, 185L, 188L, 191L, 197L, 200L, 
            206L, 209L, 212L, 215L, 218L, 221L, 224L, 227L, 230L, 233L, 236L, 
            239L, 242L, 245L, 248L, 251L, 257L, 260L, 263L, 266L, 269L, 272L, 
            275L, 278L, 281L, 284L, 290L, 293L, 299L, 302L, 305L, 308L, 311L, 
            320L, 326L, 329L, 332L, 341L, 344L, 347L, 350L, 353L, 356L, 359L, 
            362L), 
    pm25 = c(13.9, 5.5, 3.2, 5.9, 4, 12.6, 7.1, 9.3, 11.5, 
             8.3, 7.4, 10.1, 14.3, 11, 10.5, 11, 4.3, 7.5, 8.3, 8.2, 5.5, 
             13, 18.9, 7.3, 7.3, 11.3, 5.4, 7.2, 11.6, 12.1, 6.8, 7.2, 10, 
             7.4, 7.1, 18.5, 19.1, 6.3, 8.3, 16.3, 22.4, 8.7, 17.1, 18.7, 
             15.7, 10.7, 18, 8, 14.1, 20.4, 8.4, 6.6, 23.5, 12.1, 11.7, 12, 
             27.7, 10.3, 9.7, 13.1, 6.1, 6.4, 9.2, 4.8, 8.4, 5.2, 8.1, 13.8, 
             7.6, 13.9, 17.7, 15.8, 12.3, 12, 7.8, 13, 6.2, 17.2, 14.2, 13.6, 
             7.2, 13.2, 14.5, 7.2, 5.7, 6.8, 11.5, 9.2, 4.6, 11, 8.2, 2.5, 
             9.3, 7.8, 10.9, 19.5, 19.7, 11.2, 10, 5.8, 3.9, 15.4, 7.3, 7, 
             7.2, 8.5, 4.3, 5.3, 4.9, 6.3)
  ), 
  class = c("tbl_df", "tbl", "data.frame"), 
  row.names = c(NA, -110L)
)


parallel::mclapply(
  1,
  function(x) {
    system.time({
      lm = spLM(
        pm25 ~ 1, data = site_data, coords = cbind(x=site_data$day, y=0),
        starting = list(sigma.sq = 1,   tau.sq = 1,   phi = sqrt(3)/30),
        tuning   = list(sigma.sq = 0.1, tau.sq = 0.1, phi = 0.1),
        priors   = list(beta.Norm = list(0,1000), phi.Unif = c(sqrt(3)/30-1e-6, sqrt(3)/30+1e-6),
                        sigma.sq.IG = c(2, 2), tau.sq.IG = c(2, 0.1)),
        cov.model = "gaussian",
        amcmc = list(n.batch = 1000, batch.length = 50, accept.rate = 0.43),
        verbose = FALSE
      )
    })
  },
  mc.cores = 1
)

